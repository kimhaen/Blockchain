Block Chain
------

#### 1.1 Distributed Ledger (분산원장)
- 블록체인을 탈중앙화 된 시스템으로 만드는 핵심기술
- 블록체인에 참여하는 모든 사람이 동일한 원장을 소유하고 관리하는 기술
- 하이퍼레저 패브릭에서는 **채널(Channel)** 개념을 도입하여 프라이버시 문제를 해결
- 모든 정보가 해시화 되어, Append-only 방식으로 기록되므로 **불가변성(immuntability)**의 특성

#### 1.2 Smart Contract
- 블록체인 참여자는 스마트 컨트랙트를 통해 분산원장에 정보를 기록하거나 불러온다
- 거래의 자동화 등 다양한 응용프로그램을 만들 수 있다
- 분산 애플리케이션의 활용

#### 1.3 합의
- PoW(Proof of Work), DPoS(Delegated Proof of Stake) 방식 등이 있음
- 하이퍼레저 패브릭의 합의 과정은, PoW, PoS 혹은 BFT 처럼 특정 알고리즘에 국한되지 않음
#### **하이퍼레저 패브릭의 합의 과정**
- 보증 정책 확인
- 트랜잭션을 정해진 순서에 맞춰 정렬
- 정렬된 트랜잭션의 유효성 검증 후 최신 블록 업데이트
 

## Hyperledger Fabric 

[Doc](https://hyperledger-fabric.readthedocs.io/)


### 1.1 하이퍼레저 프로젝트
- 리눅스에서 개발한 라이퍼레저 프로젝트 (프레임워크, 툴)

#### **하이퍼레저 프레임워크(Frameworks)**
- 하이퍼레저 프레임워크(Frameworks)는 분산원장, 스마트 컨트랙트, 합의 알고리즘 등 블록체인에 대한 원천적인 기술을 개발하는 프로젝트
  - Hyperledger Fabric
  - Hyperledger Sawtooth
  - Hyperledger Iroha
  - Hyperledger Indy
  - Hyperledger Burrow
    
#### **하이퍼레저 툴(Tool)**     
- 블록체인 시스템의 성능 측정, 운영, 개발을 돕는 툴
- - Hyperledger Caliper
  - Hyperledger Cello
  - Hyperledger Composer
  - Hyperledger Explorer
  - Hyperledger Quilt

### 1.2 하이퍼레저 패브릭 개요
- 가장 왕성하게 활동중인 프로젝트
- **허가형 프라이빗 블록체인(Permissioned and Private Blockchain)**
- 퍼블릭 블록체인과 달리 **MSP(Membership Service Provide)**라는 인증관리 시스템에 등록된 사용자만이 참여가능
- 비즈니스 목적에 맞는 형태로 블록체인 플랫폼을 구축
- **채널(Channel)** 개념을 도입하여 프라이버시 문제를 해결
- 모든 사용자가 동일한 원장을 가지고 모든 정보를 공유할 수 있을 뿐만 아니라, 비즈니스에 민감한 내용을 공유하고 싶은 참여자들 간에만 채털을 통해서 별도의 원장을 생성하여 정보 공유 가능
- **원장(Shared Ledger)** 은 월드스테이트와 블록체인의 두 가지 구성요소로 이루어짐
#### **월드 스테이트(World State)**
- 원장의 현재상태
- 은행 잔고로 예를들면, 현재 잔고
  
#### **블록체인(BlockChain)**
- 원장의 전체기록
- 은행을 예로들면 계좌생성부터 현재까지 결제(입출금) 모든 내역

- 스마트 컨트랙트는 **체인코드(ChainCode)** 에 쓰여진다.
- 체인코드는 스마트 컨트랙트와 같이 원장에 데이터를 읽고 쓰기 위해 사용될 수 있다.
- 하이퍼레저 패브릭의 합의 알고리즘은 PBFT나, 비트코인의 PoW 등의 합의 방식과는 달리, 트랜잭션의 생성부터 새로운 블록 생성까지 모든 과정을 통칭해서 합의 과정이라고 한다.

### 1.3 하이퍼레저 패브릭 특징

- **프라이버시와 기밀성**
- **작업 구간별 병렬 처리**
- **체인코드**
- **모듈화된 디자인**

- 채널 개념을 도입하여, 프라이버시와 기밀성 제공
- 트랜잭션의 생성부터 합의 과정까지 단계별로 분리하여 처리 가능
- **실행(Execute)** 단계에서는 트랜잭션을 실행하고 결과값을 검증
- **정렬(Order)** 단계에서는 실행단계에서 검증이 끝난 트랜잭션을 취합하여 순서에 맞게 정렬한 후 블록을 생성하는 작업을 수행
- **검증(Validation)** 단계에서는 블록에 포함된 모든 트랜잭션에 대한 결과값 검증을 수행
- 체인코드는 기존 블록체인의 스마트 컨트랙트와 동일한 기능을 가지고 있으며, Go와 Node.js를 이용해서 다양한 형태의 응용 프로그램으로 개발 될 수 있다.
- 시스템 체인코드는 트랜잭션의 보증, 블록 검증, 채널 설정 등 시스템 레벨에서의 설정이 필요할 때 사용되는 체인코드


### 2.1 하이퍼레저 패브릭 구성요소

### **Peer**
- 하이퍼레저 패브릭 블록체인을 구성하는 네트워크 노드 중 하나
- 분산원장과 스마트컨트랙트를 Peer가 관리하는 역할을 수행
- 하이퍼레저 패브릭 블록체인 참여자는 peer에 설치된 스마트 컨트랙트를 호출하여 분산원장에 저장된 정보에 접근
- peer는 복수 개의 분산원장과 체인코드를 가질 수도 있으며, peer에 저장되고 설치되기 때문에 하이퍼레저 패브릭 참여자는 peer를 통해서만 분산원장과 체인코드에 접근가능


### **Chaincode**
- 기능은 크게 읽기와 쓰기의 두 종류의 함수
- 블록체인의 핵심은 한 번 기록된 데이터는 위/변조가 불가능한 분산원장에 있음
- 분산원장에 데이터를 기록하거나 읽기 위해 체인코드를 이용
- 비즈니스 모델에 맞는 분산 애플리케이션과 함께 개발되어 사용
- 하이퍼레저 패브릭에서는 **시스템 체인코드**라는 특수한 체인코드를 사용
####  **시스템 체인코드**
- QSCC(Query) - 블록체인의 저장된 데이터를 읽어올 때 사용 / CLI명령어 사용
- ESCC(Endorsment) - 보증정책을 담당
- VSCC(Validation) - 블록을 검증할 때 사용
- CSCC(Configuration) - 채널 설정시 사용되는 시스템 체인코드
- LSCC(Lifecycle) - 체인코드의 설치부터 인스턴스화까지 모든 일련의 과정을 수행하는데 사용되는 체인코드

### **DApp**
- 사용자가 분산 환경에서 비즈니스 거래 등을 편리하게 해 주기 위해 사용되는 애플리케이션
- 분산 애플리케이션 개발을 위해 다양한 종류의 SDK를 제공
- DApp을 통한 분산원장 데이터 읽기 과정

트랜잭션 생성 요청 – peer 와 연결 – 체인코드 실행 요청 – 체인코드 실행 – 결과값 반환

- Dapp을 통한 분산원장 데이터 쓰기 과정

트랜잭션 생성 요청 – peer 와 연결 – 체인코드 실행 요청 – 체인코드 실행

- 보증 허가된 트랜잭션 반환 – 보증 허가된 트랜잭션 전달 – 트랜잭션 최신 블록에 포함
- 최신 블록 전달 – 업데이트 완료 알림

### **Endorsement policy**
- 보증정책은 트랜잭션을 생성하는 클라이언트(분산 애플리캐이션)와 peer간에 작동

### **Organization**
- 하이퍼레저 패브릭 블록체인에 참여한 조직들은 데이터를 공유하기 위해 채널을 생성해야하는데, 모든 조직이 한 대 이상의 peer를 채넣1에 참여시켜 데이터를 공유할 수도 있고, 직접 공유하기 위한 채널을 생성할 수 있다.

### **Channel**
- 기존의 퍼블릭 블록체인에서 제공할 수 없었던 데이터의 기밀성을 채널을 통해 제공할 수 있음
- 채널생성은 CSCC를 호출하여 생성할 수 있다

### **Ledger**
- 분산원장(Distributed Ledger)
- 현재상태(world state)와 블록체인으로 구분
- world state에 저장된 데이터는 합의 과정에 의해 블록체인에 포함되기 전까지 체인코드를 통해 조회/변경/삭제가 가능하다
- 합의에 의해 결정된 블록 및 블록체인은 절대 수정할 수 없다
- world state는 데이터의 기록, 수정, 읽기 등이 빈번하게 발생하기 때문에 분산 데이터베이스로 구축되어 있다 (LevelDB, CouchDB)
- 블록체인은 데이터요청이 거의 없고, append-only 방식의 저장이 목적이기 때문에 파일시스템 형태로 저장되어 있다

#### **World State**
- 현재 값을 관리하는 데이터베이스
- 하이퍼레저 패브릭에서는 key-value 저장 방식을 사용하는 LevelDB와 JSON 포맷의 저장 방식을 사용하는 CouchDB 중 하나를 선택해서 World state 데이터베이스를 구축
- version 정보가 있다. version은 World state가 업데이트될 때마다 증가한다.
- 트랜잭션의 version값과 World state의 version값의 일치여부를 확인한 후 업데이트 실행여부가 결정

#### **블록 & 블록체인**
- 정해진 용량 만큼 혹은 일정 시간 동안 발생한 트랜잭션은 하나의 블록이 된다
- 생성된 블록들이 합의 과정을 마친 후 암호학적 기법을 통해 생성된 순서대로 연결되어 저장되는 데이터가 블록체인이 된다
- 블록헤더에는 현재 발생하고 있는 트랜잭션에 대한 해시값과 이전단계에 생성된 블록의 해시값이 포함
- 각 블록에는 Header, Data, Metadata 필드가 존재
##### **Block Header**
- Block number : 0부터 시작하여 합의 과정에 의해 블록이 생성될 때 마다 숫자가 1씩 증가
- Current block hash : 현재 블록에 포함되어 있는 트랜잭션의 해시값
- Previous block hash : 이전 블록에 대한 해시값

##### **트랜잭션 구조도**
- Block data에는 해당 블록에 포함된 트랜잭션이 순서대로 저장되어 있다.
- Header : 트랜잭션의 version정보와 트랜잭션이 실행되는 체인코드의 이름 등이 명시
- Signature : 트랜잭션 생성자의 Identity 관련 디지털 인증서 정보가 있다
- Proposal : 체인코드에 들어가는 트랜잭션의 입력값이 저장. 해당 입력값을 이용해 체인코드를 실행
- Response : 트랜잭션 처리 결과값을 Read/Write set 형대로 반환하는 필드
  Read는 proposal이 반영되기 전 값, write는 proposal값이 반영된 후의 값을 의미
- Endorsement : 트랜잭션을 보증해 준 peer의 Identity 정보가 포함되어 있다. 보증정책에 따라서 한 개 혹은 여러개 가 될 수 있다.
- Chaincode name : 트랜잭션이 실행되는 체인코드를 구분하는 데 사용. peer가 트랜잭션을 입력받으면, Chaincode name이 가리키는 체인코드를 실행

##### **트랜잭션 구조도**
- 블록생성자의 Identity 정보, 블록에 포함되어 있는 Transaction 보증 여부 등이 포함

### **Gossip**
- peer는 Gossip 프로토콜을 통해 같은 채널 내 peer들을 랜덤하게 선택하여 분산원장을 전송.
- Gossip 프로토콜을 통해 분산원장을 수신한 peer는 자신의 분산원장과 비교하여 업데이트 된 최신정보가 있으면 자신의 분산원장에 해당 내용을 업데이트

### **Identity**
- 허가된 사용자만 블록체인 플랫폼에 참여 가능하며, 사용자가 어떻게 접근 권한을 얻는지, peer와 orderer로 구성된 하이퍼레저 패브릭 네트워크에서 어떻게 서로의 신원을 확인하는지와 관련
- PKI(public key infrastructure)기반의 디지털 인증서
- PKI는 CA라고 불리는 네트워크 노드하에 관리. CA는 디지털 인증서를 안전하게 관리해 주는 기관이며, 디지털 인증서를 필요한 사용자에게 발급/저장/삭제 하는 역할을 수행

### **MSP**
- MSP(Membership service Provider) Identity 기술을 바탕으로 만든 하이퍼레저 패브릭 멤버십 관리 기술이다.
- MSP를 이용해서 peer, orderer, Fabric-CA, Admin 등의 역할과 소속, 권한 등을 정의할 수 있다.

### **Orderer**
-orderer에 의해 peer들이 동일한 최신 블록을 서로 공유하는 과정.
1. 트랜잭션 제출 -분산애플리케이션이 트랜잭션 보증을 담당하는 Endorsing peer에게 트랜잭션을 제출하는 것부터 해당 트랜잭션이 가리키는 체인코드가 실행되기 까지
2. 블록 패키징 - 트랜잭션 제출과정에서 제출한 트랜잭션을 orderer가 수집하여 순서대로 정렬한 후 최신 블록을 생성하는 과정
3. 검증 - orderer가 생성한 최신블록을 각 조직의 peer들에게 전달하고, 최신 블록을 전달받은 peer는 해당 블록이 올바르게 생성됐는지 검증
